# ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ä»•æ§˜

## æ¦‚è¦

Lunirã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚WebSocketã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã‚’å®Ÿç¾ã€‚

## æ©Ÿèƒ½è¦ä»¶

### åŸºæœ¬ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
1. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°**
   - WebSocketã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€å—ä¿¡
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å³åº§è¡¨ç¤º
   - æ¥ç¶šçŠ¶æ…‹ã®ç®¡ç†

2. **ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ç®¡ç†**
   - ãƒ«ãƒ¼ãƒ ä½œæˆãƒ»å‚åŠ ãƒ»é€€å‡º
   - ãƒ«ãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†
   - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ«ãƒ¼ãƒ 

3. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½**
   - ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
   - ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼‰
   - LaTeXæ•°å¼ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
   - è¿”ä¿¡æ©Ÿèƒ½

## æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### WebSocketé€šä¿¡ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant C as Client
    participant WS as WebSocket
    participant B as Backend
    participant DB as Database

    C->>WS: connect with JWT token
    WS->>B: authenticate user
    B->>DB: verify user
    DB->>B: user info
    B->>WS: auth success
    WS->>C: connected

    C->>WS: join_room
    WS->>B: add user to room
    B->>DB: update room_members
    WS->>C: room_joined

    C->>WS: send_message
    WS->>B: process message
    B->>DB: save message
    B->>WS: broadcast to room
    WS->>C: message_received (all room members)
```

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼

```typescript
interface WebSocketMessage {
  type: 'join_room' | 'leave_room' | 'send_message' | 'message_received' | 'user_joined' | 'user_left' | 'error'
  payload: any
  timestamp: string
  message_id?: string
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
interface SendMessagePayload {
  room_id: number
  content: string
  message_type: 'text' | 'code'
  parent_id?: number  // è¿”ä¿¡æ©Ÿèƒ½ç”¨
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
interface MessageReceivedPayload {
  id: number
  content: string
  message_type: 'text' | 'code'
  user: {
    id: number
    username: string
    display_name?: string
    avatar_url?: string
  }
  room_id: number
  parent_id?: number
  created_at: string
}
```

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### REST API

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ | èªè¨¼ |
|---------|---------------|------|------|
| GET | `/api/v1/rooms` | ãƒ«ãƒ¼ãƒ ä¸€è¦§å–å¾— | å¿…è¦ |
| POST | `/api/v1/rooms` | ãƒ«ãƒ¼ãƒ ä½œæˆ | å¿…è¦ |
| GET | `/api/v1/rooms/{room_id}` | ãƒ«ãƒ¼ãƒ è©³ç´°å–å¾— | å¿…è¦ |
| POST | `/api/v1/rooms/{room_id}/join` | ãƒ«ãƒ¼ãƒ å‚åŠ  | å¿…è¦ |
| POST | `/api/v1/rooms/{room_id}/leave` | ãƒ«ãƒ¼ãƒ é€€å‡º | å¿…è¦ |
| GET | `/api/v1/rooms/{room_id}/messages` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´å–å¾— | å¿…è¦ |

### WebSocketæ¥ç¶š

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---------------|------|
| `/ws/chat` | ãƒãƒ£ãƒƒãƒˆç”¨WebSocketæ¥ç¶š |

## å®Ÿè£…æ‰‹é †

### Phase 1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…
1. âœ… WebSocketãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼å®Ÿè£…
2. âœ… ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ CRUDå®Ÿè£…  
3. âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†å®Ÿè£…
4. âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡å®Ÿè£…

### Phase 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
1. ğŸš§ WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…
2. ğŸš§ ãƒãƒ£ãƒƒãƒˆUIå®Ÿè£…
3. ğŸš§ ãƒ«ãƒ¼ãƒ ç®¡ç†ç”»é¢å®Ÿè£…
4. ğŸš§ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºãƒ»é€ä¿¡å®Ÿè£…

### Phase 3: é«˜åº¦ãªæ©Ÿèƒ½
1. âœ… ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆå®Ÿè£…
2. âœ… è¿”ä¿¡æ©Ÿèƒ½å®Ÿè£…
3. â¸ï¸ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹è¡¨ç¤º
4. â¸ï¸ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆå…¨ãƒ«ãƒ¼ãƒ æ¨ªæ–­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼‰

## UI/UXè¨­è¨ˆ

### ãƒãƒ£ãƒƒãƒˆç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (Lunir + User Info)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Room List   â”‚ â”‚ Chat Area               â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â€¢ General   â”‚ â”‚ â”‚ Message History     â”‚ â”‚ â”‚
â”‚ â”‚ â€¢ Random    â”‚ â”‚ â”‚                     â”‚ â”‚ â”‚
â”‚ â”‚ â€¢ Dev       â”‚ â”‚ â”‚ User1: Hello!       â”‚ â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â”‚ User2: Hi there     â”‚ â”‚ â”‚
â”‚ â”‚ [+ New Room]â”‚ â”‚ â”‚                     â”‚ â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â”‚ [Message Input...]  â”‚ â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â”‚              [Send] â”‚ â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. WebSocketèªè¨¼
- JWT ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹èªè¨¼
- æ¥ç¶šæ™‚ã®èªè¨¼æ¤œè¨¼
- ç„¡åŠ¹ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¥ç¶šæ‹’å¦

### 2. èªå¯åˆ¶å¾¡
- ãƒ«ãƒ¼ãƒ å‚åŠ æ¨©é™ãƒã‚§ãƒƒã‚¯
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ¨©é™ãƒã‚§ãƒƒã‚¯
- ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### 3. å…¥åŠ›æ¤œè¨¼
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- æ–‡å­—æ•°åˆ¶é™
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆã‚¹ãƒ‘ãƒ å¯¾ç­–ï¼‰

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### 1. ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£
- WebSocketæ¥ç¶šæ•°ç®¡ç†
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡åŠ¹ç‡åŒ–
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæœ€é©åŒ–

### 2. ãƒ¡ãƒ¢ãƒªç®¡ç†
- å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
- æ¥ç¶šãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã®åŠ¹ç‡çš„èª­ã¿è¾¼ã¿

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 1. å˜ä½“ãƒ†ã‚¹ãƒˆ
- WebSocketãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ†ã‚¹ãƒˆ
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- èªè¨¼ãƒ»èªå¯ãƒ†ã‚¹ãƒˆ

### 2. çµ±åˆãƒ†ã‚¹ãƒˆ
- WebSocketæ¥ç¶šãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
- ãƒ«ãƒ¼ãƒ æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

### 3. è² è·ãƒ†ã‚¹ãƒˆ
- åŒæ™‚æ¥ç¶šæ•°ãƒ†ã‚¹ãƒˆ
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ