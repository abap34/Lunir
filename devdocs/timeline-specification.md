# ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ä»•æ§˜

## æ¦‚è¦

å…¨ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çµ±åˆã—ã¦æ™‚ç³»åˆ—é †ã«è¡¨ç¤ºã™ã‚‹ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ«ãƒ¼ãƒ ã‚’è·¨ã„ã§å…¨ä½“ã®ä¼šè©±ã®æµã‚Œã‚’æŠŠæ¡ã§ãã‚‹ã€‚

## æ©Ÿèƒ½è¦ä»¶

### åŸºæœ¬æ©Ÿèƒ½
1. **å…¨ãƒ«ãƒ¼ãƒ çµ±åˆè¡¨ç¤º**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‚åŠ ã—ã¦ã„ã‚‹å…¨ãƒ«ãƒ¼ãƒ ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çµ±åˆ
   - æ™‚ç³»åˆ—é †ï¼ˆæœ€æ–°ãŒä¸Šï¼‰ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
   - ãƒ«ãƒ¼ãƒ æƒ…å ±ã‚’å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¡¨ç¤º

2. **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½**
   - ç‰¹å®šãƒ«ãƒ¼ãƒ ã®ã¿è¡¨ç¤º
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆãƒ†ã‚­ã‚¹ãƒˆ/ã‚³ãƒ¼ãƒ‰ï¼‰
   - æ—¥ä»˜ç¯„å›²æŒ‡å®š

3. **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**
   - ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ
   - åˆå›50ä»¶ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è¿½åŠ èª­ã¿è¾¼ã¿

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«æ´»ç”¨
ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ã¯æ—¢å­˜ã®`messages`ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ´»ç”¨ã€‚è¿½åŠ ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã¯ä¸è¦ã€‚

### å¿…è¦ãªã‚¯ã‚¨ãƒªãƒ‘ã‚¿ãƒ¼ãƒ³

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‚åŠ ã—ã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ ã®å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ™‚ç³»åˆ—å–å¾—
SELECT m.*, u.username, u.display_name, u.avatar_url, r.name as room_name
FROM messages m
JOIN users u ON m.user_id = u.id
JOIN chat_rooms r ON m.room_id = r.id
JOIN room_members rm ON r.id = rm.room_id
WHERE rm.user_id = ?
ORDER BY m.created_at DESC
LIMIT ? OFFSET ?;

-- ç‰¹å®šãƒ«ãƒ¼ãƒ ãƒ•ã‚£ãƒ«ã‚¿ä»˜ã
WHERE rm.user_id = ? AND m.room_id = ?

-- æ—¥ä»˜ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿ä»˜ã
WHERE rm.user_id = ? 
  AND m.created_at >= ? 
  AND m.created_at <= ?
```

### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–

```sql
-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã®ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_messages_timeline ON messages(created_at DESC, room_id);
CREATE INDEX idx_room_members_user_timeline ON room_members(user_id, room_id);
```

## APIè¨­è¨ˆ

### REST ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|---------|---------------|------|------------|
| GET | `/api/v1/timeline` | ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å–å¾— | limit, offset, room_id?, start_date?, end_date? |
| GET | `/api/v1/timeline/stats` | ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³çµ±è¨ˆ | - |

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

```typescript
interface TimelineMessage {
  id: number
  content: string
  message_type: string
  user: {
    id: number
    username: string
    display_name?: string
    avatar_url?: string
  }
  room: {
    id: number
    name: string
    is_private: boolean
  }
  parent_id?: number
  has_latex: boolean
  has_code: boolean
  created_at: string
}

interface TimelineResponse {
  messages: TimelineMessage[]
  total_count: number
  has_more: boolean
}
```

## UI/UXè¨­è¨ˆ

### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (Lunir + User Info)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Timeline Filters                        â”‚ â”‚
â”‚ â”‚ [All Rooms â–¼] [All Types â–¼] [ğŸ“… Date] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Timeline Messages                       â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ #general | User1 | 14:30           â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ Hello, this is a message!           â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ #dev     | User2 | 14:25           â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ ```python                           â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ print("Hello World")                â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ ```                                 â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚ [Load More...]                          â”‚ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰

å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ã«ã¯ä»¥ä¸‹ã‚’è¡¨ç¤º:
- **ãƒ«ãƒ¼ãƒ å**: ãƒãƒƒã‚¸å½¢å¼ã§è¡¨ç¤º
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±**: ã‚¢ãƒã‚¿ãƒ¼ã€åå‰
- **æŠ•ç¨¿æ™‚åˆ»**: ç›¸å¯¾æ™‚é–“è¡¨ç¤º
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹**: ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³/ã‚³ãƒ¼ãƒ‰å¯¾å¿œ
- **ãƒ«ãƒ¼ãƒ ã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³**: ãã®ãƒ«ãƒ¼ãƒ ã®ãƒãƒ£ãƒƒãƒˆã«ç›´æ¥ç§»å‹•

## å®Ÿè£…è¨ˆç”»

### Phase 1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…
1. **ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç”¨ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…**
   - `TimelineService.get_user_timeline()`
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

2. **REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…**
   - `/api/v1/timeline` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¯¾å¿œ
   - é©åˆ‡ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

### Phase 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
1. **ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ä½œæˆ**
   - `TimelinePage.tsx` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°UI

2. **ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
   - `TimelineMessageCard.tsx`
   - ãƒ«ãƒ¼ãƒ æƒ…å ±è¡¨ç¤º
   - ãƒ«ãƒ¼ãƒ ã‚¸ãƒ£ãƒ³ãƒ—æ©Ÿèƒ½

### Phase 3: é«˜åº¦ãªæ©Ÿèƒ½
1. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**
   - WebSocketçµŒç”±ã§ã®æ–°ç€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€šçŸ¥
   - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è‡ªå‹•æ›´æ–°
   
2. **æ¤œç´¢æ©Ÿèƒ½**
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã§ã®æ¤œç´¢
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ•ã‚£ãƒ«ã‚¿

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### 1. ã‚¯ã‚¨ãƒªæœ€é©åŒ–
- é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ
- JOINæœ€é©åŒ–
- ã‚¯ã‚¨ãƒªå®Ÿè¡Œè¨ˆç”»ã®åˆ†æ

### 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
- æœ€æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥
- CDNã«ã‚ˆã‚‹é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡

### 3. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
- ã‚«ãƒ¼ã‚½ãƒ«ãƒ™ãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ¡ç”¨
- å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã®æ€§èƒ½ç¢ºä¿

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. æ¨©é™åˆ¶å¾¡
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‚åŠ ã—ã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿è¡¨ç¤º
- ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ ã®é©åˆ‡ãªåˆ¶å¾¡

### 2. ãƒ‡ãƒ¼ã‚¿éœ²å‡ºé˜²æ­¢
- é€€å‡ºå¾Œã®ãƒ«ãƒ¼ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯éè¡¨ç¤º
- å‰Šé™¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é©åˆ‡ãªå‡¦ç†

## å®Ÿè£…å„ªå…ˆåº¦

ç¾åœ¨ã®ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ãŒå®Œæˆã—ã¦ã„ã‚‹ãŸã‚ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ã¯æ¯”è¼ƒçš„ç°¡å˜ã«å®Ÿè£…å¯èƒ½ï¼š

1. **é«˜å„ªå…ˆåº¦**: åŸºæœ¬ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º
2. **ä¸­å„ªå…ˆåº¦**: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
3. **ä½å„ªå…ˆåº¦**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã€æ¤œç´¢æ©Ÿèƒ½

å®Ÿè£…æ™‚é–“è¦‹ç©ã‚‚ã‚Š: 1-2æ—¥ç¨‹åº¦ï¼ˆåŸºæœ¬æ©Ÿèƒ½ï¼‰